{"version":3,"file":"ngo.js","sourceRoot":"","sources":["../src/ngo.ts"],"names":[],"mappings":";;AAAA,yBAAkC;AAElC,IAAM,WAAW,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;AAE5C,2CAAsD;AACtD,+CAA2D;AAC3D,uDAAmE;AACnE,2CAAuD;AACvD,+DAA6D;AAG7D,IAAM,cAAc,GAAG,YAAY,CAAC;AACpC,IAAM,mBAAmB,GAAG,gBAAgB,CAAC;AAU7C,aAAoB,OAAmB;IACrC,OAAO,CAAC,aAAa,GAAG,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC;IACxC,IAAA,qCAAa,EAAE,qCAAa,EAAE,uCAAc,EAAE,uBAAM,CAAa;IACnE,IAAA,yBAAO,CAAa;IAE1B,EAAE,CAAC,CAAC,CAAC,aAAa,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;QAC/B,MAAM,IAAI,KAAK,CAAC,0DAA0D,CAAC,CAAC;IAC9E,CAAC;IAED,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;QACb,OAAO,GAAG,iBAAY,CAAC,aAAuB,EAAE,OAAO,CAAC,CAAC;IAC3D,CAAC;IAED,EAAE,CAAC,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,mBAAmB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACtE,MAAM,CAAC,0CAAmB,CAAC;YACzB,OAAO,SAAA;YACP,iGAAiG;YACjG,aAAa,EAAE;gBACb,wCAAyB;gBACzB,gDAA6B;gBAC7B,oCAAuB;gBACvB,mCAAsB;aACvB;YACD,aAAa,eAAA;YACb,aAAa,eAAA;YACb,cAAc,gBAAA;YACd,MAAM,QAAA;SACP,CAAC,CAAC;IACL,CAAC;IAED,EAAE,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC;QAClB,oCAAoC;QACpC,IAAM,EAAE,GAAG,IAAI,WAAW,CAAC,OAAO,CAAC,CAAC;QACpC,MAAM,CAAC;YACL,OAAO,SAAA;YACP,SAAS,EAAE,EAAE,CAAC,WAAW,CAAC;gBACxB,MAAM,EAAE,aAAa;gBACrB,IAAI,EAAE,cAAc,GAAM,cAAc,SAAM,GAAG,IAAI;gBACrD,cAAc,EAAE,IAAI;gBACpB,KAAK,EAAE,IAAI;aACZ,CAAC;SACH,CAAC;IACJ,CAAC;IAAC,IAAI,CAAC,CAAC;QACN,MAAM,CAAC;YACL,OAAO,SAAA;YACP,SAAS,EAAE,IAAI;SAChB,CAAC;IACJ,CAAC;AACH,CAAC;AAhDD,kBAgDC","sourcesContent":["import { readFileSync } from 'fs';\r\nimport { RawSourceMap } from 'source-map';\r\nconst MagicString = require('magic-string');\r\n\r\nimport { getFoldFileTransformer } from './class-fold';\r\nimport { getImportTslibTransformer } from './import-tslib';\r\nimport { getPrefixFunctionsTransformer } from './prefix-functions';\r\nimport { getScrubFileTransformer } from './scrub-file';\r\nimport { transformJavascript } from './transform-javascript';\r\n\r\n\r\nconst HAS_DECORATORS = /decorators/;\r\nconst HAS_CTOR_PARAMETERS = /ctorParameters/;\r\n\r\nexport interface NgoOptions {\r\n  content?: string;\r\n  inputFilePath?: string;\r\n  outputFilePath?: string;\r\n  emitSourceMap?: boolean;\r\n  strict?: boolean;\r\n}\r\n\r\nexport function ngo(options: NgoOptions): { content: string, sourceMap: RawSourceMap | null } {\r\n  options.emitSourceMap = !!options.emitSourceMap;\r\n  const { inputFilePath, emitSourceMap, outputFilePath, strict } = options;\r\n  let { content } = options;\r\n\r\n  if (!inputFilePath && !content) {\r\n    throw new Error('Either filePath or content must be specified in options.');\r\n  }\r\n\r\n  if (!content) {\r\n    content = readFileSync(inputFilePath as string, 'UTF-8');\r\n  }\r\n\r\n  if (HAS_DECORATORS.test(content) || HAS_CTOR_PARAMETERS.test(content)) {\r\n    return transformJavascript({\r\n      content,\r\n      // Order matters, getPrefixFunctionsTransformer needs to be called before getFoldFileTransformer.\r\n      getTransforms: [\r\n        getImportTslibTransformer,\r\n        getPrefixFunctionsTransformer,\r\n        getScrubFileTransformer,\r\n        getFoldFileTransformer,\r\n      ],\r\n      emitSourceMap,\r\n      inputFilePath,\r\n      outputFilePath,\r\n      strict,\r\n    });\r\n  }\r\n\r\n  if (emitSourceMap) {\r\n    // Emit a sourcemap with no changes.\r\n    const ms = new MagicString(content);\r\n    return {\r\n      content,\r\n      sourceMap: ms.generateMap({\r\n        source: inputFilePath,\r\n        file: outputFilePath ? `${outputFilePath}.map` : null,\r\n        includeContent: true,\r\n        hires: true,\r\n      }),\r\n    };\r\n  } else {\r\n    return {\r\n      content,\r\n      sourceMap: null,\r\n    };\r\n  }\r\n}\r\n"]}